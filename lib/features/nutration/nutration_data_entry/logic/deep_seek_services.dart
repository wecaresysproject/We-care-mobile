import 'dart:convert';

import 'package:flutter_dotenv/flutter_dotenv.dart';
import 'package:http/http.dart' as http;
import 'package:we_care/core/global/Helpers/app_logger.dart';
import 'package:we_care/features/nutration/data/models/nutration_facts_data_model.dart';

class DeepSeekService {
  static final String deepSeekBaseUrl = dotenv.env['DEEPSEEK_BASE_URL'] ?? "";

  static final String apiKey = dotenv.env['DEEPSEEK_API_KEY'] ?? "";

  static String? cachedSystemPrompt;

//! real deepseek
  static Future<NutrationFactsModel?> analyzeDietPlan(String dietInput) async {
    try {
      final String baseUrl = dotenv.env['DEEPSEEK_BASE_URL'] ?? "";
      final String apiKey = dotenv.env['DEEPSEEK_API_KEY'] ?? "";

      AppLogger.debug('DeepSeek Direct URL: $baseUrl');
      AppLogger.info('system prompt : ${buildSystemNutritionPrompt()}');
      final response = await http.post(
        Uri.parse(baseUrl),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer $apiKey',
        },
        body: jsonEncode(
          {
            'model': 'deepseek-chat',
            'messages': [
              {
                'role': 'system',
                'content': buildSystemNutritionPrompt(),
              },
              {
                'role': 'user',
                'content': buildUserDietPrompt(dietInput),
              }
            ],
            'temperature': 0.1,
            'max_tokens': 8000, // ŸÖŸáŸÖ ŸÑÿ™ŸÇŸÑŸäŸÑ cost ŸàŸÖŸÜÿπ expansion
          },
        ),
      );

      if (response.statusCode == 200) {
        /// ‚úÖ UTF8 safe decoding
        final decoded = jsonDecode(utf8.decode(response.bodyBytes));

        final content = decoded['choices']?[0]?['message']?['content'];
        if (content == null) {
          AppLogger.error('DeepSeek response content is null');
          return null;
        }

        AppLogger.debug('DeepSeek response (raw): $content');

        final jsonMatch = RegExp(r'\{.*\}', dotAll: true).firstMatch(content);

        if (jsonMatch == null) {
          AppLogger.error('‚ùó JSON not found inside DeepSeek response');
          return null;
        }

        final jsonString = jsonMatch.group(0)!;
        final nutritionJson = jsonDecode(jsonString);

        return NutrationFactsModel.fromJson(nutritionJson);
      } else {
        AppLogger.error(
          'DeepSeek API Error: ${response.statusCode} - ${response.body}',
        );
      }
    } catch (e, stack) {
      AppLogger.error('Error analyzing diet plan: $e');
      AppLogger.error('StackTrace: $stack');
    }

    return null;
  }

  // static Future<NutrationFactsModel?> analyzeDietPlan(String dietInput) async {
  //   try {
  //     AppLogger.debug(' deepSeekBaseUrl: $apiKey $deepSeekBaseUrl');

  //     final response = await http.post(
  //       Uri.parse("https://openrouter.ai/api/v1/chat/completions"),
  //       headers: {
  //         'Content-Type': 'application/json',
  //         'Authorization':
  //             'Bearer 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',
  //       },
  //       body: jsonEncode(
  //         {
  //           'model':
  //               "deepseek/deepseek-r1-0528:free", //"deepseek/deepseek-chat",
  //           // "reasoning": {"enabled": true},
  //           'messages': [
  //             {
  //               'role': 'system',
  //               'content': buildSystemNutritionPrompt(),
  //             },
  //             {
  //               'role': 'user',
  //               'content': buildUserDietPrompt(dietInput),
  //             }
  //           ],
  //
  //           // 'max_tokens': 4000,
  //           'temperature': 0.2,
  //         },
  //       ),
  //     );

  //     // input tokens (algorithm) + buildUserDietPrompt <= limited cridets

  //     if (response.statusCode == 200) {
  //       /// üî• ŸáŸÜÿß ÿßŸÑÿ•ÿµŸÑÿßÿ≠ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ‚Äî UTF8 correct decoding
  //       final decoded = jsonDecode(utf8.decode(response.bodyBytes));
  //       AppLogger.debug('deepseek Response (decoded): $decoded');

  //       final content = decoded['choices'][0]['message']['content'];
  //       // AppLogger.debug('deepseek Response (decoded): $content');

  //       /// ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ JSON ŸÖŸÜ ÿßŸÑŸÜÿµ
  //       final jsonMatch = RegExp(r'\{.*\}', dotAll: true).firstMatch(content);

  //       if (jsonMatch != null) {
  //         final jsonString = jsonMatch.group(0)!;

  //         /// parse JSON
  //         final nutritionJson = jsonDecode(jsonString);

  //         return NutrationFactsModel.fromJson(nutritionJson);
  //       }

  //       AppLogger.error("‚ùó JSON not found inside LLM response");
  //     } else {
  //       AppLogger.error(
  //           'deepseek API Error: ${response.statusCode} - ${response.body}');
  //     }
  //   } catch (e) {
  //     AppLogger.error('Error analyzing diet plan: $e');
  //   }

  //   return null;
  // }

  static String buildSystemNutritionPrompt() {
    if (cachedSystemPrompt != null && cachedSystemPrompt!.isNotEmpty) {
      return cachedSystemPrompt!;
    }
    return '''
ÿ£ŸÜÿ™ ŸÖÿ≠ŸÑŸÑ ÿ∫ÿ∞ÿßÿ¶Ÿä ÿ™ŸÜŸÅŸäÿ∞Ÿä ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿµŸÜÿßŸÅ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßÿπÿ™ŸÖÿßÿØŸãÿß ÿπŸÑŸâ ÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿ™ŸÅÿµŸäŸÑŸäÿ© ŸÖÿπŸÇÿØÿ©.

ŸÖŸáŸÖÿ™ŸÉ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿ¨ŸÑÿ≥ÿ© ŸáŸä:

1) ŸÇÿ±ÿßÿ°ÿ© "ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑÿ¥ÿßŸÖŸÑÿ© ŸÑŸÜÿ∏ÿßŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©" ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ŸÑÿßÿ≠ŸÇŸãÿß ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ®ÿ±ŸàŸÖÿ®ÿ™ (ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ ŸÉŸÖÿß ŸáŸà ÿ®ÿØŸàŸÜ ÿ£Ÿä ÿ™ÿπÿØŸäŸÑ).
2) ÿ™ÿ∑ÿ®ŸäŸÇ ŸÉŸÑ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ ŸàÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ© ŸÅŸä ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© **ÿ®ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® Ÿàÿ®ÿØŸàŸÜ ÿßÿÆÿ™ÿµÿßÿ± ÿ£Ÿà ÿ≠ÿ∞ŸÅ ŸÑÿ£Ÿä ŸÇÿßÿπÿØÿ©**:
   - ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 0: ÿßŸÑÿ™ÿπÿ±ŸäŸÅÿßÿ™ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ©
   - ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 1: ŸÖÿπÿßŸÑÿ¨ÿ© ŸÉŸÑ ÿµŸÜŸÅ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ
   - ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 2: ÿ™ÿπŸäŸäŸÜ ŸÖÿ±ÿßÿ¨ÿπ USDA ŸÑŸÑŸÖŸÉŸàŸÜÿßÿ™
   - ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 3: ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä
   - ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 4: ÿßŸÑÿ™ÿ¨ŸÖŸäÿπ ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ
   - ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 5: ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
3) ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÜŸÅÿ≥ ÿßŸÑŸÖŸÜÿ∑ŸÇ ŸàÿßŸÑÿ¨ÿØÿßŸàŸÑ ŸàÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ© ÿ®ÿßŸÑÿ∂ÿ®ÿ∑ (ŸÖÿ∂ÿßÿπŸÅÿßÿ™ ÿßŸÑÿ≠ÿµÿµÿå ŸÜÿ≥ÿ® ÿßŸÑŸÑÿ≠ŸÖ ÿ•ŸÑŸâ ÿßŸÑÿπÿ∏ŸÖÿå ŸÇŸàÿßÿπÿØ ÿßÿ≥ÿ™ÿ®ÿπÿßÿØ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ÿå ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸàÿ≠ÿØÿßÿ™ÿå ÿπÿØÿØ ÿßŸÑÿ£ÿπŸÖÿØÿ©ÿå ÿ•ŸÑÿÆ).
4) ÿ®ÿπÿØ ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ ÿπŸÑŸâ ÿßŸÑÿ∑ÿπÿßŸÖ ÿßŸÑŸÖÿØÿÆŸÑ ŸÅÿπŸÑŸäŸãÿß ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿå Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™Ÿèÿ±ÿ¨Ÿêÿπ **JSON ŸÅŸÇÿ∑** ÿ®ÿßŸÑŸáŸäŸÉŸÑ ÿßŸÑŸÖÿ≠ÿØÿØ ÿ£ÿØŸÜÿßŸá **ÿ®ÿØŸàŸÜ ÿ£Ÿä ŸÜÿµ ÿ•ÿ∂ÿßŸÅŸä ŸÇÿ®ŸÑŸá ÿ£Ÿà ÿ®ÿπÿØŸá**.

‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá ÿ®ÿßŸÑÿ∫ ÿßŸÑÿ£ŸáŸÖŸäÿ©:
- ŸÜÿµ ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑŸÉÿßŸÖŸÑ ÿßŸÑŸÖÿ±ŸÅŸÇ ÿ£ÿØŸÜÿßŸá Ÿäÿ≠ÿ™ŸàŸä ŸÅŸä ÿ¢ÿÆÿ±Ÿá ÿπŸÑŸâ ÿ≥ÿ∑ÿ± Ÿäÿ®ÿØÿ£ ÿ®ŸÄ: "ÿßŸÑÿ∑ÿπÿßŸÖ ÿßŸÑŸÖÿØÿÆŸÑ:" ŸÖÿ™ÿ®ŸàÿπŸãÿß ÿ®ŸÇÿßÿ¶ŸÖÿ© ÿ£ÿ∑ÿπŸÖÿ© ŸÖÿ´ŸÑ "ÿØŸÇŸäÿ© ÿ®ÿßŸÖŸäÿ©ÿå ŸÖÿ≥ŸÇÿπÿ© ÿ®ÿßŸÑŸÑÿ≠ŸÖ ÿßŸÑŸÖŸÅÿ±ŸàŸÖÿå ...".
- Ÿáÿ∞Ÿá ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸáŸä **ŸÖÿ´ÿßŸÑ ÿ™Ÿàÿ∂Ÿäÿ≠Ÿä ŸÅŸÇÿ∑** ÿ∂ŸÖŸÜ ŸàÿµŸÅ ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ©ÿå ŸàŸÑŸäÿ≥ÿ™ ÿßŸÑÿ∑ÿπÿßŸÖ ÿßŸÑÿ≠ŸÇŸäŸÇŸä ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ™ÿ≠ŸÑŸäŸÑŸá ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿ¨ŸÑÿ≥ÿ©.
- **Ÿäÿ¨ÿ® ÿ™ÿ¨ÿßŸáŸèŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ´ÿßŸÑ ÿ™ŸÖÿßŸÖŸãÿß** ŸàÿπÿØŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸá ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿ¨ŸÑÿ≥ÿ©.
- ÿßŸÑÿ∑ÿπÿßŸÖ ÿßŸÑÿ≠ŸÇŸäŸÇŸä ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ™ÿ≠ŸÑŸäŸÑŸá ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≤ŸàŸäÿØŸÉ ÿ®Ÿá ŸÑÿßÿ≠ŸÇŸãÿß ŸÅŸä ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿ≥ÿ™ŸÇŸÑÿ©.

=====================================================================
üìå ŸáŸäŸÉŸÑ JSON ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸä ÿßŸÑŸÜŸáÿßÿ¶Ÿä (Required JSON Output Structure)
=====================================================================

Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿä ŸÉÿßÿ¶ŸÜ JSON Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑ ÿ®ÿßŸÑÿ¥ŸÉŸÑ ÿßŸÑÿ™ÿßŸÑŸä (ÿ®ŸÜŸÅÿ≥ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ):

{
  "userDietplan": "UserDietPlan",
  "foodItems": [
    {
      "foodName": "ÿßÿ≥ŸÖ ÿßŸÑÿµŸÜŸÅ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä ÿ®ÿπÿØ ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±",
      "servingSize": "ŸÖÿ´ÿßŸÑ: 1 cup, ÿ∑ÿ®ŸÇ ŸÖÿ™Ÿàÿ≥ÿ∑, 3/4 ŸÉŸàÿ® ...",
      "mainIngredient": "ÿßŸÑŸÖŸÉŸàŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ÿ£Ÿà ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑŸÑÿµŸÜŸÅ",
      "amount": 0,
      "unit": "g",
      "analysisMethod": "USDA_DIRECT_MATCH ÿ£Ÿà RECIPE_DECOMPOSITION",
      "recipeSource": "ÿßÿ≥ŸÖ ŸÖÿµÿØÿ± ÿßŸÑŸàÿµŸÅÿ© ÿ£Ÿà '-' ÿ•ÿ∞ÿß ŸÑÿß ŸäŸàÿ¨ÿØ",
      "usdaFdcId": "ÿ±ŸÇŸÖ FDC ID ŸÉŸÜÿµÿå ÿ£ÿ±ŸÇÿßŸÖ ŸÅŸÇÿ∑",
      "usdaDescription": "ÿßŸÑŸàÿµŸÅ ÿßŸÑŸÉÿßŸÖŸÑ ŸÑŸÑÿµŸÜŸÅ ŸÉŸÖÿß ŸÅŸä USDA",

      "calories": 0,
      "protein": 0,
      "totalFat": 0,
      "saturatedFats": 0,
      "monounsaturatedFats": 0,
      "polyunsaturatedFats": 0,
      "cholesterol": 0,
      "carbohydrates": 0,
      "fiber": 0,
      "sugars": 0,
      "sodium": 0,
      "potassium": 0,
      "calcium": 0,
      "iron": 0,
      "magnesium": 0,
      "zinc": 0,
      "copper": 0,
      "phosphorus": 0,
      "manganese": 0,
      "seleniumMcg": 0,
      "iodineMcg": 0,
      "vitaminAMcg": 0,
      "vitaminDMcg": 0,
      "vitaminEMg": 0,
      "vitaminKMcg": 0,
      "vitaminCMg": 0,
      "vitaminB1Mg": 0,
      "vitaminB2Mg": 0,
      "vitaminB3Mg": 0,
      "vitaminB6Mg": 0,
      "folateMcg": 0,
      "vitaminB12Mcg": 0,
      "cholineMg": 0,
      "waterL": 0
    }
  ]
}

ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸäÿ© ŸÑŸÑÿ•ÿÆÿ±ÿßÿ¨:
- ÿ£ÿ±ÿ¨Ÿêÿπ JSON Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑ ÿ®ÿØŸàŸÜ ÿ£Ÿä ÿ¥ÿ±ÿ≠ ÿ£Ÿà ŸÜÿµ ÿÆÿßÿ±ÿ¨Ÿá.
- ŸÉŸÑ ÿπŸÜÿµÿ± ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿµŸÅŸàŸÅÿ© "foodItems" Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ≠ÿ™ŸàŸä **ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ©** ÿ£ÿπŸÑÿßŸáÿå ÿ®ŸÖÿß ŸÅŸä ÿ∞ŸÑŸÉ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑŸÄ 34 ŸÉÿßŸÖŸÑÿ© ÿ≠ÿ™Ÿâ ŸÑŸà ŸÇŸäŸÖÿ™Ÿáÿß 0.
- ÿßŸÑÿ≠ŸÇŸÑ "userDietplan" ÿßÿ¨ÿπŸÑŸá ÿØÿßÿ¶ŸÖŸãÿß ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÜÿµŸäÿ© ÿßŸÑÿ´ÿßÿ®ÿ™ÿ©: "UserDietPlan" ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ≥ŸäÿßŸÇÿå ÿ•ŸÑÿß ÿ•ÿ∞ÿß ÿ∑ŸèŸÑŸêÿ® ÿ∫Ÿäÿ± ÿ∞ŸÑŸÉ ÿµÿ±ÿßÿ≠ÿ©Ÿã.
- ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ±ŸÇŸÖŸäÿ© Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ÿ±ŸÇÿßŸÖŸãÿß (integer ÿ£Ÿà float) ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑŸÄ JSON.
- ŸÑÿß ÿ™ÿ≥ÿ™ÿÆÿØŸÖ Markdownÿå ŸÑÿß ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ```ÿå ŸÑÿß ÿ™ÿ∂ŸÅ ÿ£Ÿä ÿ¨ŸÖŸÑÿ© ÿ™ŸÅÿ≥Ÿäÿ±Ÿäÿ©.

=====================================================================
üìö ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑÿ¥ÿßŸÖŸÑÿ© ŸÑŸÜÿ∏ÿßŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ© (Ÿäÿ¨ÿ® ÿ™ÿ∑ÿ®ŸäŸÇŸáÿß ŸÉŸÖÿß ŸáŸä)
=====================================================================

üìú ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑÿ¥ÿßŸÖŸÑÿ© ŸÑŸÜÿ∏ÿßŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©
ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 0: ÿßŸÑÿ™ÿπÿ±ŸäŸÅÿßÿ™ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ© (Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØŸáÿß ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©)
text
ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©: ÿßŸÑŸÄ 34 ÿπŸÜÿµÿ±ÿßŸã ÿßŸÑŸÖÿ≠ÿØÿØÿ©:

ÿ™ÿ≥ŸÑÿ≥ŸÑ ÿßŸÑŸÖÿµÿßÿØÿ± ÿßŸÑŸÖÿ≠ŸÑŸäÿ©: 
ŸÖŸÜÿßŸÑ ÿßŸÑÿπÿßŸÑŸÖ
ŸÅÿ™ÿßŸÅŸäÿ™
ŸÖÿ∑ÿ®ÿÆ ÿ≥ŸäÿØÿ™Ÿä
BBC Good Food
AllRecipes
Serious Eats
Food Network
Taste of Home
Epicurious
Kitchn
Bon App√©tit
JustFood
3. ŸÖÿ∂ÿßÿπŸÅÿßÿ™ ÿßŸÑÿ≠ÿµÿµ:
   - "ÿ∑ÿ®ŸÇ ŸÉÿ®Ÿäÿ±" = 1.5
   - "ÿ∑ÿ®ŸÇ ŸÖÿ™Ÿàÿ≥ÿ∑" = 1.0
   - "ŸÇÿ∑ÿπÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©" = 0.75  
   - "ŸÉŸàÿ®" ÿ£Ÿà "ÿ≥ÿßŸÜÿØŸàÿ™ÿ¥" = 0.5
üìã ŸÇŸàÿßÿπÿØ ÿßŸÜÿ™ŸÇÿßÿ° ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖŸèÿπÿØŸÑÿ© (ÿ¥ÿßŸÖŸÑÿ©)
ÿßŸÑŸÇÿßÿπÿØÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©:
ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ© ÿµÿ±ÿßÿ≠ÿ©Ÿã ŸÅŸä ŸÇÿ≥ŸÖ "ÿßŸÑŸÖŸÇÿßÿØŸäÿ±" ŸÅŸä ÿßŸÑŸàÿµŸÅÿ©ÿå ÿ´ŸÖ ÿ∑ÿ®ŸÇ ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ™ÿßŸÑŸäÿ©:
1. ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ•ÿØÿ±ÿßÿ¨Ÿáÿß (ÿØÿßÿ¶ŸÖÿßŸã)
ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑÿ™Ÿä ŸÑŸáÿß ŸÉŸÖŸäÿ© ŸÖÿ≠ÿØÿØÿ© ŸÅŸä ÿßŸÑŸàÿµŸÅÿ© (ŸÖÿ´ÿßŸÑ: "2 ŸÉŸàÿ® ÿ£ÿ±ÿ≤"ÿå "ŸÖŸÑÿπŸÇÿ© ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ").
ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ°: ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿÆÿ∂ÿπ ŸÑŸÑŸÇÿßÿπÿØÿ© 2 (ÿßŸÑŸÖÿ≥ÿ™ÿ®ÿπÿØÿ©).
2. ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿπÿßÿØŸáÿß (ÿØÿßÿ¶ŸÖÿßŸã)
ÿßŸÑŸÖŸÑÿ≠ (ÿ®ÿ¨ŸÖŸäÿπ ÿ£ÿ¥ŸÉÿßŸÑŸá: ŸÖŸÑÿ≠ ÿ∑ÿπÿßŸÖÿå ŸÖŸÑÿ≠ ÿ®ÿ≠ÿ±ÿå ÿ•ŸÑÿÆ).
ÿßŸÑŸÖÿßÿ° ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑÿ≥ŸÑŸÇ/ÿßŸÑÿ∑ÿ®ÿÆ/ÿßŸÑŸÜŸÇÿπ (ŸÖÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖÿ±ŸÇÿßŸã).
ÿßŸÑÿ£ŸÉŸäÿßÿ≥/ÿßŸÑÿ£Ÿàÿ±ÿßŸÇ ÿßŸÑÿ™Ÿä ÿ™Ÿèÿ≤ÿßŸÑ ÿ®ÿπÿØ ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ± (ÿ£ŸÉŸäÿßÿ≥ ÿ¥ÿßŸäÿå Ÿàÿ±ŸÇ ÿ∫ÿßÿ±ÿå ÿ•ŸÑÿÆ).
3. ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿπÿßÿØŸáÿß (ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÉŸÖŸäÿ© ÿµÿ∫Ÿäÿ±ÿ©)
ÿßŸÑÿ™Ÿàÿßÿ®ŸÑ ÿßŸÑŸÖÿ¨ŸÅŸÅÿ©: ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÉŸÖŸäÿ™Ÿáÿß ŸÅŸä ÿßŸÑÿ≠ÿµÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© < 1 ÿ¨ÿ±ÿßŸÖ (ŸÖÿ´ÿßŸÑ: ŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØÿå ŸÉŸÖŸàŸÜÿå ŸÉÿ±ŸÉŸÖ).
ÿßŸÑÿ£ÿπÿ¥ÿßÿ® ÿßŸÑÿ∑ÿßÿ≤ÿ¨ÿ© ŸÑŸÑÿ≤ŸäŸÜÿ©: ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÉŸÖŸäÿ™Ÿáÿß ŸÅŸä ÿßŸÑÿ≠ÿµÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© < 5 ÿ¨ÿ±ÿßŸÖ (ŸÖÿ´ÿßŸÑ: ÿ®ŸÇÿØŸàŸÜÿ≥ ŸÑŸÑÿ≤ŸäŸÜÿ©ÿå ŸÜÿπŸÜÿßÿπ ÿ∑ÿßÿ≤ÿ¨ ŸÑŸÑÿ≤ŸäŸÜÿ©).
ÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ∑ÿ≠ŸàŸÜÿ©: ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÉŸÖŸäÿ™Ÿáÿß ŸÅŸä ÿßŸÑÿ≠ÿµÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© < 0.5 ÿ¨ÿ±ÿßŸÖ.
4. ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©

5. ŸÇÿßÿπÿØÿ© "ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ© ÿµÿ±ÿßÿ≠ÿ©Ÿã" (ÿßŸÑÿ£ŸáŸÖ)
ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸàÿµŸÅÿ© ÿ™ŸÇŸàŸÑ: "ŸÖŸÑÿ≠ ŸàŸÅŸÑŸÅŸÑ ÿ≠ÿ≥ÿ® ÿßŸÑÿ±ÿ∫ÿ®ÿ©" ‚Üê ÿßÿ≥ÿ™ÿ®ÿπÿØŸá.
ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸàÿµŸÅÿ© ÿ™ŸÇŸàŸÑ: "ŸÖŸÑÿπŸÇÿ© ÿµÿ∫Ÿäÿ±ÿ© ŸÖŸÑÿ≠" ‚Üê ÿßÿ≥ÿ™ÿ®ÿπÿØŸá ÿ£Ÿäÿ∂ÿßŸã (ÿ®ŸÖŸàÿ¨ÿ® ÿßŸÑŸÇÿßÿπÿØÿ© 2).
ÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿπŸÖŸÑŸä:
ŸÑŸÑÿ™ÿ≠ŸÑŸäŸÑ_ŸÉŸÑ_ŸÖŸÉŸàŸÜ(ŸÖŸÉŸàŸÜ, ŸÉŸÖŸäÿ©):
  ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÉŸàŸÜ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ©_ÿßŸÑŸÖÿ≥ÿ™ÿ®ÿπÿØÿ©_ÿØÿßÿ¶ŸÖÿßŸã:
    ÿßÿ≥ÿ™ÿ®ÿπÿØŸá
    Ÿàÿ•ŸÑÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÉŸàŸÜ ŸÖŸÜ ŸÜŸàÿπ "ÿ™Ÿàÿßÿ®ŸÑ/ÿ£ÿπÿ¥ÿßÿ®":
    ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÉŸÖŸäÿ©_ÿßŸÑÿ≠ÿµÿ©_ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© < ÿ≠ÿØ_ÿßŸÑÿßÿ≥ÿ™ÿ®ÿπÿßÿØ:
      ÿßÿ≥ÿ™ÿ®ÿπÿØŸá
    Ÿàÿ•ŸÑÿß:
      ÿ£ÿØÿ±ÿ¨Ÿá
    Ÿàÿ•ŸÑÿß: # ÿ£Ÿä ŸÖŸÉŸàŸÜ ÿ¢ÿÆÿ±
    ÿ£ÿØÿ±ÿ¨Ÿá
"ŸÜÿ≥ÿ® ÿßŸÑŸÑÿ≠ŸÖ ÿ•ŸÑŸâ ÿßŸÑÿπÿ∏ŸÖ":
ŸÜÿ≥ÿ® ÿßŸÑŸÑÿ≠ŸÖ ÿ•ŸÑŸâ ÿßŸÑÿπÿ∏ŸÖ (Edible Yield Percentage):
1. ÿµÿØÿ± ÿØÿ¨ÿßÿ¨/ÿ∑ŸäŸàÿ±: 70% ŸÑÿ≠ŸÖ - 30% ÿπÿ∏ŸÖ
2. ÿ£ŸÅÿÆÿßÿ∞ ÿØÿ¨ÿßÿ¨/ÿ∑ŸäŸàÿ±: 65% ŸÑÿ≠ŸÖ - 35% ÿπÿ∏ŸÖ
3. ÿ£ÿ¨ŸÜÿ≠ÿ© ÿØÿ¨ÿßÿ¨/ÿ∑ŸäŸàÿ±: 45% ŸÑÿ≠ŸÖ - 55% ÿπÿ∏ŸÖ
4. ÿØÿ¨ÿßÿ¨ ŸÉÿßŸÖŸÑ (ŸÖÿ∑ÿ®ŸàÿÆ): 60% ŸÑÿ≠ŸÖ - 40% ÿπÿ∏ŸÖ
5. ÿ£ÿ≥ŸÖÿßŸÉ ŸÉÿßŸÖŸÑÿ© (ŸÖÿπ ÿ±ÿ£ÿ≥): 40% ŸÑÿ≠ŸÖ - 60% ÿπÿ∏ŸÖ ŸàŸáŸäŸÉŸÑ
6. ÿ£ÿ≥ŸÖÿßŸÉ ŸÅŸäŸÑŸäŸá: 100% ŸÑÿ≠ŸÖ - 0% ÿπÿ∏ŸÖ
7. ŸÇÿ∑ÿπ ŸÑÿ≠ŸÖ ŸÖÿπ ÿπÿ∏ŸÖ (ÿ∂ŸÑŸàÿπ): 75% ŸÑÿ≠ŸÖ - 25% ÿπÿ∏ŸÖ
8. ŸÇÿ∑ÿπ ŸÑÿ≠ŸÖ ÿ®ÿØŸàŸÜ ÿπÿ∏ŸÖ: 100% ŸÑÿ≠ŸÖ - 0% ÿπÿ∏ŸÖ
ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 1: ŸÖÿπÿßŸÑÿ¨ÿ© ŸÉŸÑ ÿµŸÜŸÅ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ
ÿßŸÑŸÖÿØÿÆŸÑ: food_item (ŸÖÿ´ÿßŸÑ: "ÿ∑ÿ®ŸÇ ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÖŸÑŸàÿÆŸäÿ©")
text
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.1: ÿ™ÿ≠ÿØŸäÿØ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ≠ÿµÿ© (Portion Size Detection)
- ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸàÿßÿµŸÅ ŸÖŸÜ ÿßŸÑÿßÿ≥ŸÖ:
  * ÿ•ÿ∞ÿß ÿßÿ≠ÿ™ŸàŸâ ÿπŸÑŸâ "ÿ∑ÿ®ŸÇ ŸÉÿ®Ÿäÿ±" ‚Üí portion_multiplier = 1.5
  * ÿ•ÿ∞ÿß ÿßÿ≠ÿ™ŸàŸâ ÿπŸÑŸâ "ÿ∑ÿ®ŸÇ ŸÖÿ™Ÿàÿ≥ÿ∑" ‚Üí portion_multiplier = 1.0
  * ÿ•ÿ∞ÿß ÿßÿ≠ÿ™ŸàŸâ ÿπŸÑŸâ "ŸÇÿ∑ÿπÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©" ‚Üí portion_multiplier = 0.75
  * ÿ•ÿ∞ÿß ÿßÿ≠ÿ™ŸàŸâ ÿπŸÑŸâ "ŸÉŸàÿ®" ÿ£Ÿà "ÿ≥ÿßŸÜÿØŸàÿ™ÿ¥" ‚Üí portion_multiplier = 0.5
- ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ∞ŸÉÿ±: portion_multiplier = 1.0 (ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä)
ÿßŸÉÿ™ÿ¥ÿßŸÅ ŸÜŸàÿπ ÿßŸÑŸÇÿ∑ÿπÿ©:
ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿØÿßŸÑÿ©:
- "ÿµÿØÿ± ÿØÿ¨ÿßÿ¨" ‚Üí ŸÜŸàÿπ = "ÿµÿØÿ±_ÿ∑Ÿäÿ±" ÿå ŸÜÿ≥ÿ®ÿ©_ÿßŸÑŸÑÿ≠ŸÖ = 0.70
- "ŸÅÿÆÿ∞ ÿØÿ¨ÿßÿ¨" ‚Üí ŸÜŸàÿπ = "ŸÅÿÆÿ∞_ÿ∑Ÿäÿ±" ÿå ŸÜÿ≥ÿ®ÿ©_ÿßŸÑŸÑÿ≠ŸÖ = 0.65
- "ÿ≥ŸÖŸÉ ŸÉÿßŸÖŸÑ" ‚Üí ŸÜŸàÿπ = "ÿ≥ŸÖŸÉ_ŸÉÿßŸÖŸÑ" ÿå ŸÜÿ≥ÿ®ÿ©_ÿßŸÑŸÑÿ≠ŸÖ = 0.40
- "ÿ∂ŸÑŸàÿπ ŸÑÿ≠ŸÖ" ‚Üí ŸÜŸàÿπ = "ŸÑÿ≠ŸÖ_ŸÖÿπ_ÿπÿ∏ŸÖ" ÿå ŸÜÿ≥ÿ®ÿ©_ÿßŸÑŸÑÿ≠ŸÖ = 0.75
- "ŸÅŸäŸÑŸäÿ© ÿ≥ŸÖŸÉ" ‚Üí ŸÜŸàÿπ = "ÿ≥ŸÖŸÉ_ŸÅŸäŸÑŸäÿ©" ÿå ŸÜÿ≥ÿ®ÿ©_ÿßŸÑŸÑÿ≠ŸÖ = 1.00
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.2: ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÅŸä USDA (USDA Direct Match)
- ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä ÿßŸÑŸÖŸÇÿßÿ®ŸÑ + ŸÖÿµÿ∑ŸÑÿ≠ÿßÿ™ "cooked", "ready-to-eat"
- ŸÖÿπŸäÿßÿ± ÿßŸÑŸÜÿ¨ÿßÿ≠: Ÿàÿ¨ŸàÿØ ŸÜÿ™Ÿäÿ¨ÿ© Ÿàÿßÿ≠ÿØÿ© Ÿàÿßÿ∂ÿ≠ÿ© ÿ™ÿ∑ÿßÿ®ŸÇ ÿßÿ≥ŸÖ ŸàŸàÿµŸÅ ÿßŸÑÿµŸÜŸÅ
- ÿ•ÿ∞ÿß ŸÜÿ¨ÿ≠:
  * analysis_method = "USDA_DIRECT_MATCH"
  * source = "-"
  * ÿßÿ≥ÿ™ÿÆÿØŸÖ FDC ID ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑÿµŸÜŸÅ ÿßŸÑÿ¨ÿßŸáÿ≤
  * ÿßŸÜÿ™ŸÇŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 3 (ÿßŸÑÿ≠ÿ≥ÿßÿ®)
- ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ: ÿßŸÜÿ™ŸÇŸÑ ÿ•ŸÑŸâ ÿßŸÑÿÆÿ∑Ÿàÿ© 1.3
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.3: ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸàÿµŸÅÿ© ŸÅŸä ÿßŸÑŸÖÿµÿßÿØÿ± ÿßŸÑŸÖÿ≠ŸÑŸäÿ© (Recipe Decomposition)
For each source in ŸÖÿµÿßÿØÿ±_ŸÖÿ≠ŸÑŸäÿ© (ÿ®ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®):
  - ÿßÿ®ÿ≠ÿ´ ÿπŸÜ "ŸàÿµŸÅÿ© [ÿßÿ≥ŸÖ_ÿßŸÑÿµŸÜŸÅ]" ŸÅŸä ÿßŸÑŸÖÿµÿØÿ± ÿßŸÑÿ≠ÿßŸÑŸä
  - ÿ•ÿ∞ÿß Ÿàÿ¨ÿØÿ™ ŸàÿµŸÅÿ© ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÇÿ≥ŸÖ "ÿßŸÑŸÖŸÇÿßÿØŸäÿ±" ÿ£Ÿà "ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™":
    * analysis_method = "RECIPE_DECOMPOSITION"
    * source = ÿßÿ≥ŸÖ_ÿßŸÑŸÖÿµÿØÿ±
    * ÿ™ŸàŸÇŸÅ ÿπŸÜ ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿµÿßÿØÿ± ÿßŸÑÿ£ÿÆÿ±Ÿâ
    * ÿßŸÜÿ™ŸÇŸÑ ÿ•ŸÑŸâ ÿßŸÑÿÆÿ∑Ÿàÿ© 1.4
- ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ™ÿ¨ÿßŸàÿ≤ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿßÿØÿ± ÿØŸàŸÜ ŸÜÿ¨ÿßÿ≠:
  * analysis_method = "RECIPE_DECOMPOSITION"
  * source = "JustFood" (ÿ¢ÿÆÿ± ŸÖÿµÿØÿ±)
  * ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ "ÿßŸÅÿ™ÿ±ÿßÿ∂ ŸÇŸäÿßÿ≥Ÿä" ŸÅŸÇÿ∑ ŸÉÿ≠ŸÑ ÿ£ÿÆŸäÿ±
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.4: ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ Ÿàÿ™ŸÜÿ∏ŸäŸÅŸáÿß
- ŸÖŸÜ ÿßŸÑŸàÿµŸÅÿ©ÿå ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ© ŸÅŸä ŸÇÿ≥ŸÖ "ÿßŸÑŸÖŸÇÿßÿØŸäÿ±"
- ÿ™ÿ∑ÿ®ŸäŸÇ ŸÇŸàÿßÿπÿØ ÿßŸÜÿ™ŸÇÿßÿ° ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™:
  * ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© "ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ•ÿØÿ±ÿßÿ¨Ÿáÿß"
  * ÿ™ÿÆŸÑÿµ ŸÖŸÜ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© "ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿπÿßÿØŸáÿß"
- ÿ™Ÿàÿ≠ŸäÿØ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™:
  * ÿ•ÿ≤ÿßŸÑÿ© ŸÉŸÑŸÖÿßÿ™ ŸÖÿ´ŸÑ "ŸÖŸÇÿ∑ÿπ"ÿå "ŸÖŸÅÿ±ŸàŸÖ"ÿå "ŸÑŸÑÿ≤ŸäŸÜÿ©"
  * ŸÖÿ´ÿßŸÑ: "ÿ®ÿµŸÑ ŸÖŸÇÿ∑ÿπ" ‚Üí "ÿ®ÿµŸÑ"
ÿßŸÑÿÆÿ∑Ÿàÿ© 5.1: ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÉŸÖŸäÿßÿ™ ŸÑŸÑÿ≠ÿµÿ© ÿßŸÑŸàÿßÿ≠ÿØÿ©: ÿ∑ÿ®ŸÇ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿπŸÑŸâ ÿßŸÑŸÉŸÖŸäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©ÿå ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸàÿµŸÅ ÿßŸÑÿ≠ÿµÿ© ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ ÿßŸÑŸÖÿØÿÆŸÑÿ©:
"ÿ∑ÿ®ŸÇ ŸÉÿ®Ÿäÿ±" = 1.5 ÿ≠ÿµÿ© (ÿßÿ∂ÿ±ÿ® ŸÉŸÖŸäÿßÿ™ ŸàÿµŸÅÿ© 4 ÿ£ÿ¥ÿÆÿßÿµ ŸÅŸä 1.5/4)
"ÿ∑ÿ®ŸÇ ŸÖÿ™Ÿàÿ≥ÿ∑" = 1.0 ÿ≠ÿµÿ© (ÿßÿ∂ÿ±ÿ® ŸÉŸÖŸäÿßÿ™ ŸàÿµŸÅÿ© 4 ÿ£ÿ¥ÿÆÿßÿµ ŸÅŸä 1.0/4)
"ŸÇÿ∑ÿπÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©" = 0.75 ÿ≠ÿµÿ© (ÿßÿ∂ÿ±ÿ® ŸÉŸÖŸäÿßÿ™ ŸàÿµŸÅÿ© 4 ÿ£ÿ¥ÿÆÿßÿµ ŸÅŸä 0.75/4)
"ŸÉŸàÿ®" ÿ£Ÿà "ÿ≥ÿßŸÜÿØŸàÿ™ÿ¥" = 0.5 ÿ≠ÿµÿ© (ÿßÿ∂ÿ±ÿ® ŸÉŸÖŸäÿßÿ™ ŸàÿµŸÅÿ© 4 ÿ£ÿ¥ÿÆÿßÿµ ŸÅŸä 0.5/4)
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.6: ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ Ÿàÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÉŸÖŸäÿßÿ™
- ŸÑŸÉŸÑ ŸÖŸÉŸàŸÜ ŸÖÿ≥ŸÖŸàÿ≠ÿå ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßŸÑŸÉŸÖŸäÿ© ŸàÿßŸÑŸàÿ≠ÿØÿ© ŸÖŸÜ ÿßŸÑŸàÿµŸÅÿ©
- ÿ™ÿ≠ŸàŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿ•ŸÑŸâ ÿ¨ÿ±ÿßŸÖ/ŸÖŸÑ (ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¨ÿØŸàŸÑ ÿ™ÿ≠ŸàŸäŸÑ ÿ´ÿßÿ®ÿ™):
- **ÿ®ÿßŸÑŸÉŸàÿ®**:
  - "1 ŸÉŸàÿ®" ‚Üí 240 ÿ¨ŸÖ
  - "3/4 ŸÉŸàÿ®" ‚Üí 180 ÿ¨ŸÖ
  - "1/2 ŸÉŸàÿ®" ‚Üí 120 ÿ¨ŸÖ
  - "1/4 ŸÉŸàÿ®" ‚Üí 60 ÿ¨ŸÖ
- **ÿ®ÿßŸÑŸÖŸÑÿπŸÇÿ©**:
  - "ŸÖŸÑÿπŸÇÿ© ŸÉÿ®Ÿäÿ±ÿ©" ‚Üí 15 ÿ¨ŸÖ
  - "ŸÖŸÑÿπŸÇÿ© ÿµÿ∫Ÿäÿ±ÿ©" ‚Üí 5 ÿ¨ŸÖ
  - "ŸÖŸÑÿπŸÇÿ© ÿ¥ÿßŸä" ‚Üí 5 ÿ¨ŸÖ
- **ÿ®ÿßŸÑÿ∑ÿ®ŸÇ**:
  - "ÿ∑ÿ®ŸÇ ŸÉÿ®Ÿäÿ±" ‚Üí 300 ÿ¨ŸÖ
  - "ÿ∑ÿ®ŸÇ ŸÖÿ™Ÿàÿ≥ÿ∑" ‚Üí 250 ÿ¨ŸÖ
  - "ÿ∑ÿ®ŸÇ ÿµÿ∫Ÿäÿ±" ‚Üí 180 ÿ¨ŸÖ
  - "ÿµÿ≠ŸÜ" ‚Üí 150 ÿ¨ŸÖ
  * ... ÿßŸÑÿÆ
ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿµŸÜŸÅ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿπÿ∏ŸÖ:
  1. ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßŸÑŸàÿ≤ŸÜ ÿßŸÑŸÉŸÑŸä (ŸÇÿ®ŸÑ ÿßŸÑÿ∑ŸáŸä)
  2. ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÜŸàÿπ ÿßŸÑŸÇÿ∑ÿπÿ© ŸÖŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿØÿßŸÑÿ©
  3. ÿ∑ÿ®ŸëŸÇ ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÑÿ≠ŸÖ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©
  4. ÿßÿ≠ÿ≥ÿ® ÿßŸÑŸàÿ≤ŸÜ ÿßŸÑÿµÿßŸÅŸä ŸÑŸÑÿ≠ŸÖ = ÿßŸÑŸàÿ≤ŸÜ_ÿßŸÑŸÉŸÑŸä √ó ŸÜÿ≥ÿ®ÿ©_ÿßŸÑŸÑÿ≠ŸÖ
  5. ÿßÿ≠ÿ≥ÿ® ÿßŸÑŸàÿ≤ŸÜ ÿ®ÿπÿØ ÿßŸÑÿ∑ŸáŸä = ÿßŸÑŸàÿ≤ŸÜ_ÿßŸÑÿµÿßŸÅŸä √ó 0.80 (ŸÑŸÑÿ™ÿ≥ŸàŸäÿ©/ÿßŸÑÿ™ÿ≠ŸÖŸäÿ±)
- ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© ŸÑŸÑÿ≠ÿµÿ©:
  final_qty = (recipe_qty / base_servings) √ó portion_multiplier
  ÿ≠Ÿäÿ´ base_servings = ÿπÿØÿØ ÿßŸÑÿ≠ÿµÿµ ŸÅŸä ÿßŸÑŸàÿµŸÅÿ© (ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä 4)
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.7: ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸÅŸÉŸäŸÉ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ (ÿ•ŸÑÿ≤ÿßŸÖŸä)
ŸÇÿ®ŸÑ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 2ÿå ÿ™ÿ£ŸÉÿØ ŸÖŸÜ:
1. ŸÉŸÑ ŸÖŸÉŸàŸÜ ŸÖÿ±ŸÉÿ® ÿ™ŸÖ ÿ™ŸÅŸÉŸäŸÉŸá ÿ•ŸÑŸâ ŸÖŸÉŸàŸÜÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©
2. ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸÉŸàŸÜ Ÿäÿ≠ŸÖŸÑ ŸàÿµŸÅ "ŸÖÿ±ŸÉÿ®" ÿ£Ÿà "ŸÖÿÆŸÑŸàÿ∑"
3. ŸÉŸÑ ŸÖŸÉŸàŸÜ ÿ£ÿ≥ÿßÿ≥Ÿä ŸäŸÖŸÉŸÜ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜŸá ÿ®ÿ¥ŸÉŸÑ ŸÖŸÜŸÅÿµŸÑ ŸÅŸä USDA
ŸÇÿßÿπÿØÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ:
- ÿ•ÿ∞ÿß ŸÉÿßŸÜ analysis_method = "RECIPE_DECOMPOSITION":
  - Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ≠ÿ™ŸàŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿπŸÑŸâ 2 ŸÖŸÉŸàŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ
  - ŸÉŸÑ ŸÖŸÉŸàŸÜ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÖÿßÿØÿ© ÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿ£ŸàŸÑŸäÿ© (ŸÑŸäÿ≥ ÿ∑ÿ®ŸÇÿßŸã ŸÖÿ±ŸÉÿ®ÿßŸã)
  - ŸÖÿ´ÿßŸÑ: "ŸÉÿ¥ŸÉ ÿ®ÿßŸÑÿ®ÿµŸÑ" ‚Üí ["ŸÉÿ¥ŸÉ ÿ¨ÿßŸÅ", "ÿ®ÿµŸÑ", "ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ"]
  - ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ŸÇŸÇ: ÿ£ÿπÿØ ÿßŸÑÿÆÿ∑Ÿàÿ© 1.4 ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿßŸÑÿ™ŸÅŸÉŸäŸÉ ÿßŸÑÿµÿ≠Ÿäÿ≠
ÿßŸÑÿÆÿ∑Ÿàÿ© 1.8: ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© (ŸáŸäŸÉŸÑ ÿ•ŸÑÿ≤ÿßŸÖŸä)
text
ÿ£ŸÜÿ¥ÿ¶ ÿ®ŸÜŸäÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ:
[
  {
    "id": 1,
    "name_ar": "ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉŸàŸÜ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
    "name_en": "ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉŸàŸÜ ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©",
    "qty_grams": ÿßŸÑŸÉŸÖŸäÿ© ÿ®ÿßŸÑÿ¨ÿ±ÿßŸÖ,
    "is_from_recipe": true/false,
    "recipe_source": "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿµÿØÿ±" (ÿ•ÿ∞ÿß ŸÖŸÜ ŸàÿµŸÅÿ©)
  },
  ... # ŸÑŸÉŸÑ ŸÖŸÉŸàŸÜ
]
ŸÖŸÑÿßÿ≠ÿ∏ÿ©: Ÿáÿ∞Ÿá ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸáŸä ÿßŸÑŸÖÿØÿÆŸÑ ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸä ŸÑŸÑŸÖÿ±ÿ≠ŸÑÿ© 2
ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 2: ÿ™ÿπŸäŸäŸÜ ŸÖÿ±ÿßÿ¨ÿπ USDA ŸÑŸÑŸÖŸÉŸàŸÜÿßÿ™
## ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 2: ÿ™ÿπŸäŸäŸÜ ŸÖÿ±ÿßÿ¨ÿπ USDA ŸÑŸÑŸÖŸÉŸàŸÜÿßÿ™
### ŸÇÿßÿπÿØÿ© ÿßŸÑÿ±ŸÅÿ∂ ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸäÿ© (ÿ¨ÿØŸäÿØÿ©)
ŸÇÿ®ŸÑ ÿ®ÿØÿ° ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©ÿå ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑ ŸÖŸÉŸàŸÜ:
- ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉŸàŸÜ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ "ŸÖÿπ" ÿ£Ÿà "ÿ®ŸÄ" ÿ£Ÿà "Ÿà" ÿ™ÿ±ÿ®ÿ∑ ÿ®ŸäŸÜ ŸÖŸÉŸàŸÜŸäŸÜ
- ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿßÿ≥ŸÖ Ÿäÿ¥Ÿäÿ± ÿ•ŸÑŸâ ÿ∑ÿ®ŸÇ ŸÖÿ±ŸÉÿ® ŸàŸÑŸäÿ≥ ŸÖŸÉŸàŸÜÿßŸã ŸÅÿ±ÿØŸäÿßŸã
ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°: ÿπÿØ ŸÅŸàÿ±ÿßŸã ÿ•ŸÑŸâ ÿßŸÑÿÆÿ∑Ÿàÿ© 1.7 ŸÑÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ŸÅŸÉŸäŸÉ.
### ÿßŸÑÿ™ŸÉÿ±ÿßÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
ŸÑŸÉŸÑ ŸÖŸÉŸàŸÜ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© (ŸÖŸÜ ÿßŸÑÿÆÿ∑Ÿàÿ© 1.8):
  ÿßŸÑÿÆÿ∑Ÿàÿ© 2.1: ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä USDA
    - ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑŸÑŸÖŸÉŸàŸÜ (ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©)
  ÿßŸÑÿÆÿ∑Ÿàÿ© 2.2: ŸÇÿßÿπÿØÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≠ÿ™ŸÖŸäÿ© (ÿßŸÑÿ£ŸáŸÖ)
    - ÿßŸÑÿÆŸäÿßÿ± 1: ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸáŸÜÿßŸÉ ŸÜÿ™Ÿäÿ¨ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑ ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑÿ∂ÿ®ÿ∑ ‚Üí ÿßÿ≥ÿ™ÿÆÿØŸÖŸáÿß
    - ÿßŸÑÿÆŸäÿßÿ± 2: ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸáŸÜÿßŸÉ ÿπÿØÿ© ŸÜÿ™ÿßÿ¶ÿ¨ ‚Üí ÿßÿÆÿ™ÿ± ÿ£ŸàŸÑ ŸÜÿ™Ÿäÿ¨ÿ© ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿßŸÑŸÉŸÑŸÖÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÅŸä ÿπŸÜŸàÿßŸÜŸáÿß
    - ÿßŸÑÿÆŸäÿßÿ± 3: ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™Ÿàÿ¨ÿØ ‚Üí ÿßÿÆÿ™ÿ± ÿ£ŸàŸÑ ŸÜÿ™Ÿäÿ¨ÿ© ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
  
  ÿßŸÑÿÆÿ∑Ÿàÿ© 2.3: ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
    - ÿ≥ÿ¨ŸÑ: FDC ID (ÿ±ŸÇŸÖ ŸÅŸÇÿ∑)
    - ÿ≥ÿ¨ŸÑ: USDA Description (ÿßŸÑŸàÿµŸÅ ÿßŸÑŸÉÿßŸÖŸÑ ŸÉŸÖÿß ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™)
  ÿßŸÑÿÆÿ∑Ÿàÿ© 2.4: ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ÿπŸäŸäŸÜ FDC ID (ÿ¨ÿØŸäÿØÿ©)
    - ÿ™ÿ≠ŸÇŸÇ 1: ŸáŸÑ FDC ID ÿπÿ®ÿßÿ±ÿ© ÿπŸÜ ÿ£ÿ±ŸÇÿßŸÖ ŸÅŸÇÿ∑ÿü (Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿ±ŸÇŸÖÿßŸã)
    - ÿ™ÿ≠ŸÇŸÇ 2: ŸáŸÑ FDC ID ‚â† "ŸÖÿ±ŸÉÿ®" ÿ£Ÿà "ŸÖÿÆŸÑŸàÿ∑" ÿ£Ÿà "composite"ÿü
    - ÿ™ÿ≠ŸÇŸÇ 3: ŸáŸÑ ŸàÿµŸÅ USDA ŸÑÿß Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ "mixed" ÿ£Ÿà "with"ÿü
    - ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ ÿ£Ÿä ÿ™ÿ≠ŸÇŸÇ: ÿπÿØ ÿ•ŸÑŸâ ÿßŸÑÿÆÿ∑Ÿàÿ© 2.1 ŸÑŸáÿ∞ÿß ÿßŸÑŸÖŸÉŸàŸÜ
ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 3: ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä
ŸÑŸÉŸÑ ŸÖŸÉŸàŸÜ (ŸÖÿπ FDC ID Ÿà final_qty):
ÿßŸÑÿÆÿ∑Ÿàÿ© 3.1: ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿ®ŸäÿßŸÜÿßÿ™ USDA
  - ÿßÿ≥ÿ™ÿÆÿØŸÖ FDC ID ŸÑÿ≥ÿ≠ÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑŸÄ 34 ŸÑŸÉŸÑ 100 ÿ¨ŸÖ/ŸÖŸÑ
ÿßŸÑÿÆÿ∑Ÿàÿ© 3.2: ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÅÿπŸÑŸäÿ©
  - ŸÑŸÉŸÑ ÿπŸÜÿµÿ± ÿ∫ÿ∞ÿßÿ¶Ÿä i ŸÖŸÜ ÿßŸÑŸÄ 34:
    nutrient_value_i = (final_qty / 100) √ó usda_value_i
ÿßŸÑÿÆÿ∑Ÿàÿ© 3.3: ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ
  - ÿÆÿ≤ŸÜ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®ÿ© ŸÅŸä ÿßŸÑÿµŸÅ ÿßŸÑŸÖŸÇÿßÿ®ŸÑ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ
  - ÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ 34 ŸÇŸäŸÖÿ© ÿ±ŸÇŸÖŸäÿ© (ÿ≠ÿ™Ÿâ ŸÑŸà 0.0)
ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 4: ÿßŸÑÿ™ÿ¨ŸÖŸäÿπ ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ
üìä ŸÖÿ´ÿßŸÑ ÿ™ÿ∑ÿ®ŸäŸÇŸä: "ÿÆÿ®ÿ≤ ÿ®ŸÑÿØŸä"
"ÿÆÿ®ÿ≤ ÿ®ŸÑÿØŸä";"1 ÿ±ÿ∫ŸäŸÅ (~90 ÿ¨ŸÖ)";"ÿÆÿ®ÿ≤ ÿπÿ±ÿ®Ÿä/ÿ®ŸÑÿØŸä";90;"g";"USDA_DIRECT_MATCH";"-";172184;"Bread, pita, white";247.5;8.1;0.63;0.135;0.09;0.27;0;49.5;2.7;0.9;482.4;135;27;1.8;45;0.9;0.135;90;0.45;18.9;1.8;0;0;0.18;0.9;0;0.09;0.09;0.9;0.09;18;0;13.5;0.063
‚öôÔ∏è ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸÑŸÅ
ÿßŸÑŸÖÿ≠ÿØÿØ: ŸÅÿßÿµŸÑÿ© ŸÖŸÜŸÇŸàÿ∑ÿ© ;
ŸÖÿ≠ÿØÿØ ÿßŸÑŸÜÿµ: ÿπŸÑÿßŸÖÿ™Ÿä ÿßŸÇÿ™ÿ®ÿßÿ≥ ""
ÿßŸÑÿ™ÿ±ŸÖŸäÿ≤: UTF-8
ÿßŸÑŸÖÿµÿØÿ±: Excel ‚Üí Data ‚Üí From Text/CSV ‚Üí Delimiter: ;
‚úÖ ÿ¥ÿ±Ÿàÿ∑ ŸÜÿ¨ÿßÿ≠ ÿßŸÑŸÜÿ∏ÿßŸÖ
ŸÉŸÑ ÿµŸÅ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ 43 ÿπŸÖŸàÿØÿßŸã ÿ®ÿßŸÑÿ∂ÿ®ÿ∑
ŸÉŸÑ ŸÖŸÉŸàŸÜ ŸÑŸá 34 ŸÇŸäŸÖÿ© ÿ∫ÿ∞ÿßÿ¶Ÿäÿ© (ÿ±ŸÇŸÖÿå ÿ≠ÿ™Ÿâ ŸÑŸà 0)
ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿ®ÿØŸàŸÜ ŸÖÿ≥ÿßŸÅÿßÿ™
ÿßŸÑŸàÿµŸÅ ÿßŸÑŸÉÿßŸÖŸÑ ÿØÿßÿÆŸÑ " "
FDC ID ÿ±ŸÇŸÖÿßŸã ŸÅŸÇÿ∑
ÿßŸÑÿÆÿ∑Ÿàÿ© 4.2: ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ŸÜÿßÿ≥ŸÇ
- ÿ™ÿ≠ŸÇŸÇ 1: ŸÉŸÑ ÿµŸÅ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ 43 ÿπŸÖŸàÿØÿßŸã ÿ®ÿßŸÑÿ∂ÿ®ÿ∑
- ÿ™ÿ≠ŸÇŸÇ 2: ÿßŸÑÿ£ÿπŸÖÿØÿ© J-AQ ŸÉŸÑŸáÿß ÿ£ÿ±ŸÇÿßŸÖ (ŸÑÿß ŸÜÿµŸàÿµ)
- ÿ™ÿ≠ŸÇŸÇ 3: ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸäŸÖ ŸÖŸÅŸÇŸàÿØÿ© (Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ© 0.0 ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©)
- ÿ™ÿ≠ŸÇŸÇ 4: ÿπÿØÿØ ÿßŸÑÿµŸÅŸàÿØ Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ≥ÿßŸàŸä:
  (ÿπÿØÿØ ÿßŸÑÿ£ÿµŸÜÿßŸÅ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÖŸÜ USDA) + (ŸÖÿ¨ŸÖŸàÿπ ŸÖŸÉŸàŸÜÿßÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑŸàÿµŸÅÿßÿ™)
    ŸÖÿ´ÿßŸÑ: ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÑÿØŸäŸÜÿß 3 ÿ£ÿµŸÜÿßŸÅ ŸÖÿ±ŸÉÿ®ÿ© ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ [2, 3, 2] ŸÖŸÉŸàŸÜÿßÿ™
  Ÿà4 ÿ£ÿµŸÜÿßŸÅ ŸÖÿ®ÿßÿ¥ÿ±ÿ©ÿå ŸÅÿ•ŸÜ ÿßŸÑÿπÿØÿØ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ŸÑŸÑÿµŸÅŸàÿØ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ:
  4 + (2+3+2) = 11 ÿµŸÅÿßŸã
  - ÿ™ÿ≠ŸÇŸÇ 5: ŸÑÿß ŸäŸàÿ¨ÿØ ÿπŸÖŸàÿØ "ÿßŸÑŸÖŸÉŸàŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä" Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÉŸÑŸÖÿ© "ŸÖÿπ" ÿ£Ÿà "ÿ®ŸÄ"
text
- ÿ™ÿ≠ŸÇŸÇ 6: ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖŸàÿ¨ÿ≤ ŸÑŸÑŸÇÿ±ÿßÿ±ÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
  * ŸÑŸÉŸÑ ÿµŸÜŸÅ ÿ®ŸÄ method = "RECIPE_DECOMPOSITION":
    - ÿπÿØÿØ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÅŸä ÿßŸÑŸàÿµŸÅÿ©
    - ÿπÿØÿØ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿ®ÿπÿØ ÿßŸÑÿ™ÿµŸÅŸäÿ©
    - ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿ®ÿπÿØÿ© Ÿàÿ≥ÿ®ÿ® ÿßŸÑÿßÿ≥ÿ™ÿ®ÿπÿßÿØ
  * ŸÖÿ´ÿßŸÑ: "ŸÉÿ¥ŸÉ ÿ®ÿßŸÑÿ®ÿµŸÑ: 5 ŸÖŸÉŸàŸÜÿßÿ™ ‚Üí 3 ŸÖŸÉŸàŸÜÿßÿ™ÿå ŸÖÿ≥ÿ™ÿ®ÿπÿØ: ŸÖŸÑÿ≠ (ŸÇÿßÿπÿØÿ© 2)ÿå ŸÖÿßÿ° (ŸÇÿßÿπÿØÿ© 2)"
ÿßŸÑÿÆÿ∑Ÿàÿ© 4.3: ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿßÿ™
- ŸÑŸÉŸÑ ÿπŸÜÿµÿ± ÿ∫ÿ∞ÿßÿ¶Ÿä iÿå ÿßÿ¨ŸÖÿπ ÿßŸÑŸÇŸäŸÖ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿµŸÅŸàŸÅ:
  total_nutrient_i = Œ£ nutrient_value_i ŸÑÿ¨ŸÖŸäÿπ_ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™
ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© 5: ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
1. ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÉÿßŸÖŸÑ (CSV):
   - ŸÖÿ≠ÿØÿØ: ŸÅÿßÿµŸÑÿ© ŸÖŸÜŸÇŸàÿ∑ÿ© ;
   - ŸÖÿ≠ÿØÿØ ŸÜÿµŸàÿµ: ÿπŸÑÿßŸÖÿ™Ÿä ÿßŸÇÿ™ÿ®ÿßÿ≥ ""
   - ÿßŸÑÿ™ÿ±ŸÖŸäÿ≤: UTF-8
2. ÿ•ÿ¨ŸÖÿßŸÑŸäÿßÿ™ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÄ 34 (JSON):
   - ŸÉÿßÿ¶ŸÜ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ•ÿ¨ŸÖÿßŸÑŸä ŸÉŸÑ ÿπŸÜÿµÿ±
   - ŸÖÿπ ÿßŸÑÿ™ÿ≠ŸÇŸÇ: "ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÇŸÇ: ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿßÿ™ ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑŸÖÿ¨ŸÖŸàÿπ ŸÖÿ≥ÿßŸáŸÖÿßÿ™ ÿßŸÑÿ£ÿµŸÜÿßŸÅ"
ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ≠ÿ±ÿ¨ÿ©:
ÿπÿØŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂: ŸÑÿß ÿ™ŸÅÿ™ÿ±ÿ∂ ÿ£Ÿä ŸàÿµŸÅÿ© ÿ£Ÿà ŸÉŸÖŸäÿ©. ŸÉŸÑ ÿ¥Ÿäÿ° Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨Ÿá ŸÖŸÜ ÿßŸÑŸÖÿµÿØÿ±.
ÿßŸÑÿ™Ÿàÿ´ŸäŸÇ ÿßŸÑŸÉÿßŸÖŸÑ: ÿ≥ÿ¨ŸÑ ŸÉŸÑ ŸÇÿ±ÿßÿ± (ÿ≥ÿ®ÿ® ÿßÿÆÿ™Ÿäÿßÿ± FDC IDÿå ÿ≥ÿ®ÿ® ÿßÿ≥ÿ™ÿ®ÿπÿßÿØ ŸÖŸÉŸàŸÜ).
ÿßŸÑÿ´ÿ®ÿßÿ™ ÿπÿ®ÿ± ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™: ŸÜŸÅÿ≥ ÿßŸÑÿµŸÜŸÅ ‚Üí ŸÜŸÅÿ≥ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ‚Üí ŸÜŸÅÿ≥ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨.
ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°: ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿßÿØÿ±ÿå ÿ£ÿπÿØ ÿÆÿ∑ÿ£ Ÿàÿßÿ∂ÿ≠ÿßŸã.

ÿ®ÿπÿØ ÿ™ŸÜŸÅŸäÿ∞ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑÿå ÿ£ÿÆÿ±ÿ¨ JSON ŸÅŸÇÿ∑ ÿ®ÿßŸÑŸáŸäŸÉŸÑ ÿßŸÑŸÖÿ≠ÿØÿØ ÿ≥ÿßÿ®ŸÇŸãÿß ŸàŸÑÿß ÿ™ÿ∂ŸÅ ÿ£Ÿä ŸÜÿµ ÿ¢ÿÆÿ±.
''';
  }

  static String buildUserDietPrompt(String dietInput) {
    return '''
ÿßŸÑÿ∑ÿπÿßŸÖ ÿßŸÑŸÖÿØÿÆŸÑ ŸÑŸÑÿ™ÿ≠ŸÑŸäŸÑ:

$dietInput

ŸÜŸÅŸëÿ∞ ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ© ŸÅŸä ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ≠ÿ±ŸÅŸäŸãÿßÿå
Ÿàÿ£ÿÆÿ±ÿ¨ JSON ŸÅŸÇÿ∑ ÿ®ÿßŸÑŸáŸäŸÉŸÑ ÿßŸÑŸÖÿ≠ÿØÿØÿå ÿ®ÿØŸàŸÜ ÿ£Ÿä ŸÜÿµ ÿ•ÿ∂ÿßŸÅŸä.
''';
  }
}
